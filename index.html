<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>What the Tofu</title>
    <meta name="description" content="Find vegan food in Wichita, KS" />

    <link rel="icon" href="/favicon.svg">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ef5274" />
    <meta name="msapplication-TileColor" content="#ef5274" />
    <meta name="theme-color" content="#f9eeeb" />

    <!-- Open Graph data -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content="What the Tofu" />
    <meta property="og:url" content="https://whatthetofu.com" />
    <meta property="og:description" content="Find vegan food in Wichita, KS" />
    <meta property="og:image" content="" />
    <meta property="og:site_name" content="What the Tofu" />

    <style>
      :root {
        --background: #f9eeeb;
        --background-dark: #f4e1dc;
        --text-dark: #833b27;
        --text-dark-hover: #b04f35;
        --heading: #ef5274;
        --text: #960e2b;
        --text-light: #E31643;
        --text-hover: #ef5274;
      }
      *,
      :after,
      :before {
        box-sizing: border-box;
      }
      html {
        line-height: 1.5;
        height: 100%;
      }
      body {
        margin: 0;
        padding: 0;
        background: var(--background);
        color: var(--text);
        font-family: "Nunito", sans-serif;
        height: 100%;
        overflow: hidden;
      }
      #content {
        display: flex;
        flex-direction: column;
        width: 100vw;
        height: 100%;
      }
      #results {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        margin-top: auto;
        flex: 1;
      }
      #results .controls {
        margin: 10vh 0 0;
      }
      #results .controls > a {
        color: var(--text-light);
      }
      #result {
        text-align: center;
      }
      .comments {
        max-width: 520px;
        margin: .5rem auto 0 auto;
      }
      .controls {
        align-items: center;
        justify-content: center;
        padding: 1rem;
        color: var(--text);
        font-weight: 600;
      }
      .controls .btn-icon {
        font-family: "Nunito", sans-serif;
        font-weight: 600;
        color: var(--text);
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      }
      .controls .btn-icon:hover,
      .controls .btn-icon:focus {
        color: var(--text-hover);
      }
      .space-x {
        display: flex;
      }
      .space-x > * ~ * {
        margin-left: 1rem;
      }
      .text-sm {
        font-size: 12px;
      }
      .bg-dark {
        background: var(--background-dark);
        color: var(--text-dark);
      }
      .bg-dark a {
        color: var(--text-dark);
      }
      .bg-dark a:hover {
        color: var(--text-dark-hover);
      }
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }
      h1 {
        margin: 10vh 0 0;
        font-family: "Fredoka One", cursive;
        font-size: clamp(1.5rem, 4vw, 4rem);
        line-height: 1.25;
        color: var(--heading);
      }
      a {
        text-decoration: none;
        color: var(--text)
      }
      a:hover {
        color: var(--text-hover)
      }
      button {
        -webkit-appearance: button;
        background-color: transparent;
        background-image: none;
        padding: 0;
        border: none;
        font-size: 1rem;
      }
      button::-moz-focus-inner {
        border-style: none;
        padding: 0;
      }
      button:focus {
        outline: 1px dotted;
      }
      .btn-icon {
        display: inline-flex;
        align-items: center;
      }
      .btn-icon svg {
        margin-right: 0.5em;
        opacity: 0.75;
      }
      select {
        background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M7 7l3-3 3 3m0 6l-3 3-3-3' stroke='%239f0f2e' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
        color: var(--text);
        background-repeat: no-repeat;
        background-color: var(--background);
        border-radius: 0.375rem;
        border: 1px solid var(--text);
        padding: 0.25rem 2.5rem 0.25rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
        background-position: right 0.5rem center;
        background-size: 1.5em 1.5em;
      }
      select::-ms-expand {
        display: none;
      }
      select:focus {
        outline: 1px dotted;
        border-color: var(--text-hover);
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <main id="content">
      <div id="results"></div>
      <div class="controls space-x">
        <form id="filters" class="space-x">
          <div>
            <label for="category" class="sr-only">Category</label>
            <select id="category" name="category">
              <option value="">Any category</option>
            </select>
          </div>
          <button class="btn-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
            </svg>
            Again
          </button>
        </form>
      </div>
      <div class="controls space-x text-sm bg-dark">
        <a href="https://github.com/imacrayon/whatthetofu#what-the-tofu">Contribute</a>
        <a href="https://docs.google.com/spreadsheets/d/1A_9r92JAxYahgMTRXUloCc2YUrSckfbJ6AW2kGZP72c">View all resturants</a>
      </div>
    </main>
    <script>
      window.places = []
      fetch('https://sheets.googleapis.com/v4/spreadsheets/1A_9r92JAxYahgMTRXUloCc2YUrSckfbJ6AW2kGZP72c/values/Sheet1?key=AIzaSyDeNG-eBUw5kN8HZ1fif8rS1N8xL7DXguU')
        .then(response => response.json())
        .then(response => response.values.map(row => ({
          name: row[0],
          categories: row[1] ? row[1].split(', ') : [],
          comments: row[2],
          url: row[3],
        })))
        .then(places => {
          window.places = places.slice(1) // First row contains headers
          initalize()
        })
        .catch(response => {
          document.getElementById('results').innerHTML = 'There was an error fetching resturant data.'
        })

      function initalize() {
        let filters = document.getElementById('filters')
        filters.addEventListener('submit', event => {
          event.preventDefault()
          showRandomPlace(event.target.category.value)
        })
        initalizeCatagoryMenu(filters.category)
        showRandomPlace(filters.category.value)
      }

      function initalizeCatagoryMenu(menu) {
        let category = new URLSearchParams(window.location.search).get('category')
        let categories = places.reduce((categories, place) => {
          place.categories.forEach((category) => {
            categories[category] = category
          })
          return categories
        }, {})
        menu.innerHTML = `
          ${menu.innerHTML}
          ${Object.keys(categories)
            .sort()
            .map(label =>
                `<option value="${categories[label]}" ${
                  categories[label] === category ? "selected" : ""
                }>${label}</option>`
            )}
        `
        menu.addEventListener('change', event => {
          showRandomPlace(event.target.value)
        })
      }

      function showRandomPlace(category = null) {
        let filtered = window.places
        if (category) {
          history.replaceState({ places, category }, '', `?category=${category}`)
          filtered = places.filter((place) =>
            place.categories.includes(category)
          )
        }

        let place = filtered[Math.floor(Math.random() * filtered.length)]
        document.getElementById('results').innerHTML = `
          <div id="result">
            <h1>${place.name}</h1>
            ${place.comments ? `<div class="comments">${place.comments}</div>` : '' }
            <div class="controls space-x">
              <a class="btn-icon" href="${place.url}" target="_blank">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>
                  Menu
              </a>
            </div>
          </div>
        `
      }
    </script>
  </body>
</html>
